# Visão geral 

* **Instância** → contém vários **bancos de dados** (também chamados *schemas*).
* Em cada banco você pode ter:
  * **Tabelas** (dados)
  * **Índices** (primária, únicas, secundários, fulltext, spatial)
  * **Chaves estrangeiras** (FK)
  * **Views** (visões)
  * **Triggers** (gatilhos)
  * **Procedures/Functions** (rotinas)
  * **Events** (agendamentos)
  * **Partições** (se a tabela for particionada)

## Como conectar

```bash
# Cliente clássico
mysql -h <host> -P 3306 -u <usuario> -p

# (opcional) MySQL Shell em SQL
mysqlsh --sql -h <host> -P 3306 -u <usuario> -p
```

Depois de logar:

```sql
SELECT VERSION();         -- versão do MySQL
SHOW DATABASES;           -- lista bancos
USE meu_banco;            -- seleciona o banco
```

## Comandos “rápidos” para descobrir a estrutura

```sql
-- Bancos e tabelas
SHOW DATABASES;
SHOW TABLES;                     -- no banco atual
SHOW FULL TABLES;                -- inclui tipo (BASE TABLE / VIEW)

-- Estrutura de uma tabela
DESCRIBE minha_tabela;           -- (atalho para SHOW COLUMNS)
SHOW COLUMNS FROM minha_tabela;
SHOW CREATE TABLE minha_tabela\G  -- DDL completa (índices, FKs, engine etc.)

-- Índices e chaves
SHOW INDEX FROM minha_tabela;    -- todos os índices
SHOW KEYS  FROM minha_tabela;    -- sinônimo

-- Views e Triggers
SHOW CREATE VIEW minha_view\G
SHOW TRIGGERS LIKE 'minha_%';

-- Rotinas e eventos
SHOW PROCEDURE STATUS WHERE Db='meu_banco';
SHOW FUNCTION  STATUS WHERE Db='meu_banco';
SHOW CREATE PROCEDURE nome_proc\G
SHOW CREATE FUNCTION  nome_func\G
SHOW EVENTS;
SHOW CREATE EVENT nome_evento\G
```

## Catálogo do sistema: `INFORMATION_SCHEMA` (consultas úteis)

> Útil para gerar relatórios, “data dictionary”, auditar FKs, etc.

### Tabelas do banco

```sql
SELECT TABLE_NAME, TABLE_TYPE, ENGINE, TABLE_ROWS, CREATE_TIME
FROM information_schema.TABLES
WHERE TABLE_SCHEMA = 'meu_banco'
ORDER BY TABLE_NAME;
```

### Colunas de uma tabela

```sql
SELECT COLUMN_NAME, ORDINAL_POSITION, COLUMN_TYPE, IS_NULLABLE,
       COLUMN_DEFAULT, EXTRA, COLUMN_COMMENT
FROM information_schema.COLUMNS
WHERE TABLE_SCHEMA='meu_banco' AND TABLE_NAME='minha_tabela'
ORDER BY ORDINAL_POSITION;
```

### Todas as colunas do banco (data dictionary compacto)

```sql
SELECT t.TABLE_NAME, c.ORDINAL_POSITION, c.COLUMN_NAME, c.COLUMN_TYPE,
       c.IS_NULLABLE, c.COLUMN_DEFAULT, c.EXTRA, c.COLUMN_COMMENT
FROM information_schema.COLUMNS c
JOIN information_schema.TABLES t
  ON t.TABLE_SCHEMA=c.TABLE_SCHEMA AND t.TABLE_NAME=c.TABLE_NAME
WHERE c.TABLE_SCHEMA='meu_banco' AND t.TABLE_TYPE='BASE TABLE'
ORDER BY t.TABLE_NAME, c.ORDINAL_POSITION;
```

### Chave primária e únicas

```sql
SELECT kcu.TABLE_NAME, kcu.COLUMN_NAME, kcu.ORDINAL_POSITION, tc.CONSTRAINT_TYPE
FROM information_schema.TABLE_CONSTRAINTS tc
JOIN information_schema.KEY_COLUMN_USAGE kcu
  ON tc.CONSTRAINT_SCHEMA=kcu.CONSTRAINT_SCHEMA
 AND tc.CONSTRAINT_NAME =kcu.CONSTRAINT_NAME
 AND tc.TABLE_SCHEMA   =kcu.TABLE_SCHEMA
 AND tc.TABLE_NAME     =kcu.TABLE_NAME
WHERE tc.TABLE_SCHEMA='meu_banco'
  AND tc.CONSTRAINT_TYPE IN ('PRIMARY KEY','UNIQUE')
ORDER BY kcu.TABLE_NAME, tc.CONSTRAINT_TYPE, kcu.ORDINAL_POSITION;
```

### Chaves estrangeiras (FKs)

```sql
SELECT kcu.TABLE_NAME, kcu.COLUMN_NAME,
       kcu.REFERENCED_TABLE_NAME, kcu.REFERENCED_COLUMN_NAME,
       rc.UPDATE_RULE, rc.DELETE_RULE, kcu.CONSTRAINT_NAME
FROM information_schema.KEY_COLUMN_USAGE kcu
JOIN information_schema.REFERENTIAL_CONSTRAINTS rc
  ON rc.CONSTRAINT_SCHEMA=kcu.CONSTRAINT_SCHEMA
 AND rc.CONSTRAINT_NAME  =kcu.CONSTRAINT_NAME
WHERE kcu.TABLE_SCHEMA='meu_banco'
  AND kcu.REFERENCED_TABLE_SCHEMA IS NOT NULL
ORDER BY kcu.TABLE_NAME, kcu.CONSTRAINT_NAME, kcu.ORDINAL_POSITION;
```

### CHECK constraints (MySQL 8.0.16+)

```sql
SELECT tc.TABLE_NAME, cc.CHECK_CLAUSE, tc.CONSTRAINT_NAME
FROM information_schema.TABLE_CONSTRAINTS tc
JOIN information_schema.CHECK_CONSTRAINTS cc
  ON cc.CONSTRAINT_SCHEMA=tc.CONSTRAINT_SCHEMA
 AND cc.CONSTRAINT_NAME  =tc.CONSTRAINT_NAME
WHERE tc.TABLE_SCHEMA='meu_banco' AND tc.CONSTRAINT_TYPE='CHECK';
```

### Views

```sql
SELECT TABLE_NAME AS VIEW_NAME, VIEW_DEFINITION, DEFINER, SECURITY_TYPE
FROM information_schema.VIEWS
WHERE TABLE_SCHEMA='meu_banco';
```

### Triggers

```sql
SELECT TRIGGER_NAME, EVENT_MANIPULATION AS EVENTO, EVENT_OBJECT_TABLE AS TABELA,
       ACTION_TIMING AS TEMPO, ACTION_STATEMENT
FROM information_schema.TRIGGERS
WHERE TRIGGER_SCHEMA='meu_banco';
```

### Procedures/Functions

```sql
SELECT ROUTINE_TYPE, ROUTINE_NAME, DTD_IDENTIFIER AS RETORNO,
       CREATED, LAST_ALTERED
FROM information_schema.ROUTINES
WHERE ROUTINE_SCHEMA='meu_banco'
ORDER BY ROUTINE_TYPE, ROUTINE_NAME;
```

### Events (agendador)

```sql
SELECT EVENT_NAME, STATUS, EVENT_DEFINITION, INTERVAL_VALUE, INTERVAL_FIELD,
       ON_COMPLETION, STARTS, ENDS
FROM information_schema.EVENTS
WHERE EVENT_SCHEMA='meu_banco';
```

### Particionamento

```sql
SELECT TABLE_NAME, PARTITION_NAME, PARTITION_METHOD, PARTITION_EXPRESSION
FROM information_schema.PARTITIONS
WHERE TABLE_SCHEMA='meu_banco'
ORDER BY TABLE_NAME, PARTITION_NAME;
```

### Collation/charset por tabela e coluna

```sql
-- Tabela
SELECT TABLE_NAME, TABLE_COLLATION
FROM information_schema.TABLES
WHERE TABLE_SCHEMA='meu_banco';

-- Coluna
SELECT TABLE_NAME, COLUMN_NAME, COLLATION_NAME
FROM information_schema.COLUMNS
WHERE TABLE_SCHEMA='meu_banco' AND COLLATION_NAME IS NOT NULL;
```

## Pesquisas rápidas do esquema (truques úteis)

```sql
-- Encontrar tabelas que possuem uma coluna específica
SELECT TABLE_NAME
FROM information_schema.COLUMNS
WHERE TABLE_SCHEMA='meu_banco' AND COLUMN_NAME='cliente_id';

-- Encontrar FKs que referenciam uma tabela específica
SELECT TABLE_SCHEMA, TABLE_NAME, CONSTRAINT_NAME
FROM information_schema.KEY_COLUMN_USAGE
WHERE REFERENCED_TABLE_SCHEMA='meu_banco' AND REFERENCED_TABLE_NAME='clientes';

-- Contagem de linhas estimada por tabela (estatística)
SELECT TABLE_NAME, TABLE_ROWS
FROM information_schema.TABLES
WHERE TABLE_SCHEMA='meu_banco'
ORDER BY TABLE_ROWS DESC;
```

## `performance_schema` e `sys`

* **performance\_schema**: métricas de performance em baixo nível.
* **sys** (vista “amigável” sobre o performance\_schema/information\_schema): consultas prontas, p.ex.:

  * `sys.schema_table_statistics`, `sys.schema_unused_indexes`, `sys.schema_auto_increment_columns`, etc.

```sql
SELECT * FROM sys.schema_unused_indexes WHERE table_schema='meu_banco';
```

## Exportar apenas a estrutura (DDL)

```bash
mysqldump -h <host> -u <usuario> -p \
  --no-data --routines --events --triggers \
  meu_banco > schema.sql
```

> O arquivo `schema.sql` conterá `CREATE TABLE`, índices, FKs, views, rotinas, triggers e events (sem dados).

## Permissões (quem pode ver/alterar)

```sql
-- O que seu usuário pode fazer
SHOW GRANTS FOR CURRENT_USER();

-- Privilégios por nível
SELECT * FROM information_schema.USER_PRIVILEGES;
SELECT * FROM information_schema.SCHEMA_PRIVILEGES WHERE TABLE_SCHEMA='meu_banco';
SELECT * FROM information_schema.TABLE_PRIVILEGES  WHERE TABLE_SCHEMA='meu_banco';
SELECT * FROM information_schema.COLUMN_PRIVILEGES WHERE TABLE_SCHEMA='meu_banco';
```
---
# Comandos e Funções MySQL

G|uia-prático com os **comandos (statements)** e as **funções** mais usados no MySQL — com exemplos curtos e links oficiais para você se aprofundar.

## Comandos (SQL statements)

**Categorias principais**

* **DDL (Definição de dados):** `CREATE`, `ALTER`, `DROP`, `TRUNCATE`, `RENAME`.
* **DML (Manipulação de dados):** `SELECT`, `INSERT`, `UPDATE`, `DELETE`, `REPLACE` (específico do MySQL).
* **TCL (Transação):** `START TRANSACTION`, `COMMIT`, `ROLLBACK`, `SAVEPOINT`, `SET TRANSACTION`, `LOCK/UNLOCK TABLES`.
* **DCL/Administrativos:** `CREATE USER`, `ALTER USER`, `GRANT`, `REVOKE`, `SET`, `SHOW`, `EXPLAIN`, `DESCRIBE`, `USE`, manutenção de tabelas (`ANALYZE`, `OPTIMIZE`, `REPAIR`). ([dev.mysql.com][1])

**Exemplos rápidos**

```sql
-- DDL
CREATE TABLE clientes (
  id INT PRIMARY KEY AUTO_INCREMENT,
  nome VARCHAR(100) NOT NULL,
  email VARCHAR(255) UNIQUE
);

ALTER TABLE clientes ADD COLUMN criado_em DATETIME DEFAULT CURRENT_TIMESTAMP;

-- DML
INSERT INTO clientes (nome, email) VALUES ('Ana', 'ana@exemplo.com');
UPDATE clientes SET nome = 'Ana Maria' WHERE id = 1;
DELETE FROM clientes WHERE id = 2;

-- TCL
START TRANSACTION;
UPDATE contas SET saldo = saldo - 100 WHERE id = 1;
UPDATE contas SET saldo = saldo + 100 WHERE id = 2;
COMMIT; -- ou ROLLBACK;
```

## Funções e operadores nativos (por categoria)

* **Strings:** `CONCAT`, `CONCAT_WS`, `SUBSTRING`/`SUBSTR`, `LEFT`/`RIGHT`, `LENGTH`/`CHAR_LENGTH`, `REPLACE`, `TRIM`/`LTRIM`/`RTRIM`, `LOWER`/`UPPER`, `LPAD`/`RPAD`, `LOCATE`/`INSTR`, `REGEXP_LIKE`, `REGEXP_REPLACE`, `REGEXP_SUBSTR`, `REGEXP_INSTR`. 

* **Numéricas:** `ABS`, `ROUND`, `CEIL`/`CEILING`, `FLOOR`, `MOD`, `POWER`, `SQRT`, `RAND`. 

* **Datas e horas:** `NOW`/`CURRENT_TIMESTAMP`, `CURDATE`/`CURTIME`, `DATE_ADD`/`DATE_SUB`, `ADDDATE`, `DATEDIFF`, `TIMESTAMPDIFF`, `EXTRACT`, `STR_TO_DATE`, `DATE_FORMAT`. 

* **Agregação:** `COUNT`, `SUM`, `AVG`, `MIN`, `MAX`, `GROUP_CONCAT` (muito útil!), além de modificadores com `GROUP BY`. 

* **Controle de fluxo e nulos:** `CASE`, `IF`, `IFNULL`, `NULLIF`, `COALESCE`. 

* **Conversão:** `CAST`, `CONVERT`, `BINARY`. 

* **JSON (nativo no MySQL 8+):** `JSON_EXTRACT` (operadores `->` e `->>`), `JSON_SET`, `JSON_REPLACE`, `JSON_REMOVE`, `JSON_ARRAY`, `JSON_OBJECT`, `JSON_TABLE`, `JSON_ARRAYAGG`, `JSON_OBJECTAGG`, utilitários como `JSON_PRETTY`. 

* **Funções de janela (Window):** `ROW_NUMBER`, `RANK`, `DENSE_RANK`, `LAG`, `LEAD`, `FIRST_VALUE`, `LAST_VALUE`, `NTILE`, `CUME_DIST`, `PERCENT_RANK` com `OVER (PARTITION BY ... ORDER BY ...)`. 

* **Espaciais/GIS:** `ST_AsText`, `ST_AsGeoJSON`, `ST_Distance`, `ST_Contains`, `ST_Within`, `ST_Intersects`, criadoras/conversoras de geometrias (WKT/WKB). 

* **Criptografia/Compressão:** `AES_ENCRYPT`/`AES_DECRYPT`, `SHA2`, `MD5` (legado), `RANDOM_BYTES`, `COMPRESS`/`UNCOMPRESS`. 

**Exemplos rápidos de funções**

```sql
-- Strings e regex
SELECT REGEXP_REPLACE('abc-123-xyz', '[0-9]+', '#');  -- abc-#-xyz

-- Datas
SELECT DATE_ADD('2025-10-01', INTERVAL 7 DAY);        -- 2025-10-08

-- JSON
SELECT JSON_EXTRACT('{"a":1,"b":[10,20]}', '$.b[1]'); -- 20
SELECT JSON_SET('{"a":1}', '$.b', 2);                 -- {"a": 1, "b": 2}

-- Janela
SELECT
  id, categoria, preço,
  ROW_NUMBER() OVER (PARTITION BY categoria ORDER BY preço DESC) AS rn
FROM produtos;

-- GIS (exemplo simples)
SELECT ST_Distance(ST_PointFromText('POINT(0 0)'), ST_PointFromText('POINT(3 4)')); -- 5
```

### Onde consultar a lista completa

**[MySQL 9.4 Reference Manual](https://dev.mysql.com/doc/refman/9.4/en/)**

* **[Todas as funções e operadores nativos](https://dev.mysql.com/doc/refman/9.4/en/built-in-function-reference.html):** tabela/índice oficial das funções. 
* **[Funções de string](https://dev.mysql.com/doc/refman/9.4/en/string-functions.html) (inclui `REGEXP_*`):** seção dedicada. 
* **[JSON ](https://dev.mysql.com/doc/refman/9.4/en/json-functions.html)(guia e referência):** visão geral e referência detalhada. 
* **[Funções de janela](https://dev.mysql.com/doc/refman/9.4/en/window-functions.html) (conceitos e lista):** documentação oficial. 
* **[Funções espaciais](https://dev.mysql.com/doc/refman/9.4/en/spatial-function-reference.html) (GIS):** listas e análises. 
* **[Catálogo de statements](https://dev.mysql.com/doc/refman/9.4/en/sql-statements.html) (comandos):** índice de comandos SQL. 
* **[Compressão e Criptografia](https://dev.mysql.com/doc/refman/9.4/en/encryption-functions.html):** índice de funções de compressão e croptografia. 





